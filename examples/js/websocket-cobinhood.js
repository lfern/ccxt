/**
 * refer to https://cobinhood.github.io/api-public/#overview
 *
 * @author imhazige@gmail.com
 *
 */
var WebSocket = require('ws');

var endpoint = 'wss://ws.cobinhood.com/v2/ws';

var socket = new WebSocket(endpoint);

socket.on('open', function() {
  console.log('"open" event!');
  // every 64 seconds
  socket.send(
    JSON.stringify({
      action: 'ping',
      id: Date.now() + ''
    })
  );

  // https://api.cobinhood.com/v1/market/orderbook/precisions/BTC-USDT
  // "1E-1","5E-1","1E0","5E0","1E1","5E1","1E2"
  socket.send(
    JSON.stringify({
      action: 'subscribe',
      type: 'order-book',
      trading_pair_id: 'BTC-USDT'
      // precision: '5E-1'
    })
  );

  socket.send(
    JSON.stringify({
      action: 'unsubscribe',
      channel_id: 'order-book.BTC-USDT.1E-1',
      id: 'sample_id2'
    })
  );
});

socket.on('message', function(data) {
  console.log('"message" event!', data);

  socket.close();
});

//example snapshot
const s = {
  h: ['order-book.BTC-USDT.1E-1', '2', 's'],
  d: {
    bids: [
      ['6332.4', '2', '0.09076346'],
      ['6332', '1', '0.03'],
      ['6331.9', '1', '0.03'],
      ['6331.8', '1', '0.03'],
      ['6331.3', '1', '0.03'],
      ['6330.5', '1', '0.03'],
      ['6330.2', '1', '0.29153221'],
      ['6322.3', '1', '0.01'],
      ['6320.9', '1', '0.03416747'],
      ['6320', '1', '0.06682222'],
      ['6319', '1', '0.36118071'],
      ['6317.6', '2', '0.58841854'],
      ['6314.8', '1', '0.25232208'],
      ['6314.2', '4', '1.18373882'],
      ['6313.9', '2', '0.63505655'],
      ['6312.9', '2', '0.58750682'],
      ['6312.7', '1', '0.37041679'],
      ['6312.5', '1', '0.32286395'],
      ['6311.6', '1', '0.20561917'],
      ['6311.1', '1', '0.30455043'],
      ['6310.5', '1', '0.20627769'],
      ['6309.9', '1', '0.3268755'],
      ['6309.5', '1', '0.25610456'],
      ['6307.3', '1', '0.25022672'],
      ['6295.5', '1', '0.03416747'],
      ['6280', '1', '0.01803981'],
      ['6270.1', '1', '0.03416747'],
      ['6250', '1', '1'],
      ['6245', '1', '0.06012801'],
      ['6181', '1', '0.29692163'],
      ['6155.7', '1', '0.005'],
      ['6140', '1', '0.01'],
      ['6125', '1', '0.004'],
      ['6112.2', '1', '1.26546936'],
      ['6111', '1', '0.004'],
      ['6110.5', '1', '0.06048299'],
      ['6100', '1', '0.0042'],
      ['6048', '1', '0.32'],
      ['6045', '1', '0.00418852'],
      ['6011', '1', '0.00454966'],
      ['6000', '2', '0.0442'],
      ['5900', '1', '0.0042'],
      ['5888.8', '2', '0.11946529'],
      ['5855', '1', '0.03496566'],
      ['5806', '1', '0.0198'],
      ['5805', '2', '0.0256'],
      ['5773', '1', '0.005'],
      ['5755', '2', '0.03600896'],
      ['5701', '1', '0.04'],
      ['5700', '5', '0.3126407'],
      ['5590.8', '2', '0.08618669'],
      ['5500', '1', '0.03444545'],
      ['5400', '1', '0.00644999'],
      ['5031.7', '1', '0.16'],
      ['5000', '2', '0.0253'],
      ['4800', '1', '0.01929589'],
      ['4703', '1', '0.0045'],
      ['4657.5', '1', '0.004'],
      ['4567', '1', '1'],
      ['4201', '1', '0.5'],
      ['4005', '1', '0.05'],
      ['4001', '1', '1'],
      ['4000', '1', '0.0101'],
      ['3100', '1', '0.0152'],
      ['2800.1', '1', '0.01361118'],
      ['2800', '2', '0.05937132'],
      ['2706.9', '2', '0.52395462'],
      ['2701.1', '1', '0.00909245'],
      ['2501', '4', '4'],
      ['2377', '1', '0.21033914'],
      ['2369', '1', '0.008'],
      ['1520', '1', '0.10769736'],
      ['1272', '1', '0.01361118'],
      ['1211.2', '1', '0.15236129'],
      ['1201', '1', '0.29750208'],
      ['1191', '1', '0.34945424'],
      ['1117', '1', '0.3'],
      ['1001', '1', '1'],
      ['962', '1', '0.013'],
      ['800.2', '1', '0.03'],
      ['500', '1', '0.006'],
      ['301.1', '1', '0.1'],
      ['300', '1', '0.08085381'],
      ['255.1', '1', '4.83787946'],
      ['250', '1', '0.08637338'],
      ['222.2', '1', '0.5'],
      ['212', '1', '0.7932076'],
      ['210', '1', '0.04799995'],
      ['206.6', '1', '1'],
      ['180', '1', '0.05733333'],
      ['175.4', '1', '0.06'],
      ['175.3', '1', '0.79408612'],
      ['165', '1', '0.1'],
      ['154', '1', '0.1'],
      ['150.4', '1', '4.08843086'],
      ['150', '1', '0.08085381'],
      ['124.5', '1', '0.04'],
      ['123', '1', '10'],
      ['105', '1', '1'],
      ['103', '1', '0.03'],
      ['100.6', '1', '1.1'],
      ['32.2', '1', '1.92857142'],
      ['30.1', '1', '0.03'],
      ['30', '1', '1.82539249'],
      ['25.3', '1', '3.74363637'],
      ['20', '3', '6.05'],
      ['17.4', '1', '0.06'],
      ['17.3', '1', '1'],
      ['17', '1', '0.2'],
      ['13.1', '1', '0.6'],
      ['13', '1', '10'],
      ['11.1', '1', '100'],
      ['11', '1', '4.9777807'],
      ['10.6', '1', '1.1'],
      ['10', '2', '11'],
      ['3.1', '2', '22'],
      ['3', '1', '3'],
      ['1.1', '1', '100'],
      ['1', '2', '12'],
      ['0.9', '1', '10'],
      ['0.8', '2', '11.3'],
      ['0.7', '1', '10'],
      ['0.6', '1', '100'],
      ['0.5', '2', '120'],
      ['0.4', '1', '100'],
      ['0.3', '2', '110'],
      ['0.2', '2', '230.73599999'],
      ['0.1', '10', '203.42331432']
    ],
    asks: [
      ['6342', '1', '0.86301924'],
      ['6345', '1', '0.008'],
      ['6354.6', '1', '0.212036'],
      ['6354.7', '1', '0.03'],
      ['6355.4', '1', '0.03'],
      ['6355.5', '1', '0.03'],
      ['6355.6', '1', '0.03'],
      ['6357.2', '1', '0.03'],
      ['6362.3', '1', '0.28898673'],
      ['6363.7', '1', '0.23886364'],
      ['6364.2', '1', '0.35738985'],
      ['6364.7', '2', '0.61849301'],
      ['6365.3', '1', '0.34762988'],
      ['6365.6', '1', '0.30699901'],
      ['6365.7', '2', '0.7049933'],
      ['6366.3', '1', '0.37313152'],
      ['6367.7', '1', '0.31866052'],
      ['6368.7', '1', '0.24733454'],
      ['6368.9', '1', '0.38477985'],
      ['6370.7', '2', '0.5386198'],
      ['6370.9', '3', '0.70614525'],
      ['6371.6', '1', '0.08890411'],
      ['6379.7', '1', '0.33136847'],
      ['6382.7', '1', '0.30718319'],
      ['6389.7', '1', '0.004'],
      ['6397', '1', '0.08890411'],
      ['6400', '1', '0.0215'],
      ['6422.4', '1', '0.08890411'],
      ['6450.4', '1', '0.03'],
      ['6450.9', '1', '0.03'],
      ['6453.1', '1', '0.004'],
      ['6492', '1', '0.1'],
      ['6500', '1', '0.14239199'],
      ['6510', '1', '0.004'],
      ['6520', '1', '0.01'],
      ['6537.3', '1', '0.038'],
      ['6537.4', '1', '0.004'],
      ['6550', '1', '0.01'],
      ['6553.9', '1', '0.00561592'],
      ['6557.3', '1', '0.030152'],
      ['6579.9', '1', '0.75530946'],
      ['6580', '1', '0.01'],
      ['6584', '1', '0.01'],
      ['6600', '1', '0.06'],
      ['6650', '1', '0.007'],
      ['6678.4', '1', '0.14240778'],
      ['6689', '1', '0.1'],
      ['6708.4', '1', '0.0101898'],
      ['6743.7', '1', '0.004'],
      ['6800', '2', '0.507478'],
      ['6830', '1', '0.004'],
      ['6863', '1', '0.01'],
      ['6892', '1', '0.0163'],
      ['6900', '1', '0.004'],
      ['6961', '1', '0.21823991'],
      ['7000', '1', '0.01'],
      ['7050', '1', '0.2'],
      ['7100', '1', '0.5'],
      ['7200', '2', '0.33816358'],
      ['7250', '1', '0.01'],
      ['7295', '1', '0.02'],
      ['7299', '1', '0.003'],
      ['7399', '1', '0.003'],
      ['7400', '2', '0.033'],
      ['7450', '1', '0.006'],
      ['7499', '1', '0.004'],
      ['7500', '2', '0.0454'],
      ['7507.7', '1', '0.0077104'],
      ['7591', '1', '0.03'],
      ['7641.8', '1', '0.05248457'],
      ['7653', '1', '0.01379'],
      ['7660.8', '1', '0.00751699'],
      ['7970', '1', '0.03'],
      ['8000', '2', '0.018'],
      ['8100', '1', '0.00643'],
      ['8150', '1', '0.01'],
      ['8200', '1', '0.004'],
      ['8220', '1', '0.004'],
      ['8292', '1', '0.008'],
      ['8411.3', '1', '0.00524669'],
      ['8442.2', '1', '0.004'],
      ['8490', '1', '0.012497'],
      ['8500', '1', '0.0374'],
      ['8534.7', '1', '0.00380317'],
      ['8560', '1', '0.0022'],
      ['8700', '1', '0.0046'],
      ['8772', '1', '0.02'],
      ['8806.1', '1', '0.007'],
      ['8970', '1', '0.002'],
      ['9057', '1', '0.0075'],
      ['9350', '1', '0.010213'],
      ['9487', '1', '0.002'],
      ['9500', '2', '0.042855'],
      ['9549.9', '1', '0.036'],
      ['9599', '1', '0.014'],
      ['9681.9', '1', '0.101724'],
      ['9699', '1', '0.014'],
      ['9790', '1', '0.0351'],
      ['9850', '1', '0.01166828'],
      ['9900', '1', '0.03645832'],
      ['9912', '2', '0.0534'],
      ['9978.5', '1', '0.02264'],
      ['9978.8', '1', '0.00866241'],
      ['10220', '1', '0.1066'],
      ['10468', '1', '0.01074337'],
      ['10699', '1', '0.00995'],
      ['10998', '1', '0.00995'],
      ['11299.1', '1', '0.015'],
      ['11478', '1', '0.01063592'],
      ['195098', '1', '0.004'],
      ['195099', '1', '0.004'],
      ['195150', '1', '0.02'],
      ['196000', '1', '0.05'],
      ['968000', '1', '0.07544047']
    ]
  }
};

//example update
const u = {
  h: ['order-book.BTC-USDT.1E-1', '2', 'u'],
  d: { bids: [['6332.4', '-1', '-0.052']], asks: [] }
};
